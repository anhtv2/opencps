AUI.add("liferay-social-activity-admin",function(x){var ai=x.Lang;var H=x.Node;var l=x.Widget;var R="settings-icon-close";var ad="settings-icon-expanded";var W="lfr-token";var F=[Liferay.Language.get("social-activity-limit-type-times-a-day"),Liferay.Language.get("social-activity-limit-type-times"),Liferay.Language.get("social-activity-limit-type-times-per-period")];var h="action-field";var m="active";var af="activityType";var K="";var D="boundingBox";var B=Liferay.Language.get("collapse");var ag="actions-conjunction";var t="contentBox";var T="content-field";var p="contributionIncrement";var Z="contributionLimitEnabled";var i="contributionLimitPeriod";var S="contributionLimitValue";var b="data-modelName";var P=".";var U="submit";var y=Liferay.Language.get("expand");var aa="languageKey";var Q="localizedName";var f="participationIncrement";var ah="participationLimitEnabled";var Y="participationLimitPeriod";var J="participationLimitValue";var ab=Liferay.Language.get("save");var G="selected";var ae="settings";var X="settings-button-holder";var k="settings-display";var ac="settings-field";var E="settingsJSON";var e="settings-limit";var n=" ";var a="ui";var M=P+ag;var v="input";var g=P+x.getClassName(k);var s=P+x.getClassName(ac);var o=P+R;var j=".settings-icon-toggle";var I=P+e;var aj=".social-activity-item";var r=".social-activity-details";var d="form.update-socialactivity-form";var C={src:a};var L='<button class="'+[X].join(n)+' btn btn-submit">'+ab+"</button>";var V='<li class="'+[W,ac,h].join(n)+'"></li>';var O='<span class="contribution-increment"></span>';var N=new x.Template('<span class="settings-label">{labelText}</span>','<div class="settings-controls">','<div class="field-values">','<span class="field field-text">{firstText}</span>','<select id="{languageKey}_participationIncrement" class="settings-field-node">','<tpl for="participationIncrements">','<option {[ (values == parent.participationIncrement) ? "selected" : "" ]} title="{.}" value="{.}">{.}</option>',"</tpl>","</select>",'<span class="field field-text">{secondText}</span>','<select id="{languageKey}_contributionIncrement" class="settings-field-node">','<tpl for="contributionIncrements">','<option {[ (values == parent.contributionIncrement) ? "selected" : "" ]} title="{.}" value="{.}">{.}</option>',"</tpl>","</select>",'<span class="field field-text">{thirdText}</span> <span class="field field-text field-contribution-text">{fourthText}</span>',"</div>",'<tpl if="rows.length">','<div class="settings-field-buttons">','<tpl for="buttons">','<a class="settings-button settings-button-{type}" href="javascript:;" title="{title}">','<span class="settings-icon settings-icon-{type} {cssClass}">{text}</span>',"</a>","</tpl>","</div>","</tpl>",'<div class="hide settings-limit">','<tpl for="rows">','<div class="settings-limit-row">','<span class="field field-text">{limitFirstText}</span>','<select id="{parent.languageKey}_{type}LimitValue" class="settings-field-node">','<tpl for="limitValues">','<option {[ (values == parent.limitValue) ? "selected" : "" ]} title="{.}" value="{.}">{.}</option>',"</tpl>","</select>",'<select id="{parent.languageKey}_{type}LimitPeriod" class="settings-field-node">','<tpl for="limitPeriods">','<option {[ ($index == parent.limitPeriod) ? "selected" : "" ]} title="{.}" value="{$index}">{.}</option>',"</tpl>","</select>",'<tpl if="limitSecondText">','<span class="field field-text">{limitSecondText}.</span>',"</tpl>","</div>","</tpl>","</div>","</div>");var c=new x.Template('<div class="settings-header yui3-widget-hd">','<div class="settings-header-label">{headerText}</div>','<ul class="settings-actions">','<li class="actions-conjunction hide">{conjunctionText}</li>',"</ul>","</div>",'<div class="settings-container-label">{containerText}</div>','<ul class="container-drop-box yui3-widget-bd"></ul>','<div class="btn-row yui3-widget-ft">','<button class="btn btn-primary btn-submit">{saveText}</button>',"</div>");var z=x.Component.create({AUGMENTS:[Liferay.PortletBase],EXTENDS:x.Base,NAME:"socialactivityadmin",prototype:{initializer:function(al){var A=this;A._originalConfig=al;A._contentBox=x.one(r);var ak=x.one(d);var ao=A._getItemByName(ak,E);var an=A.byId(ae);var ap=x.all(aj);ak.detach(U);ak.on(U,A._onSocialActivityFormSubmit,A);A._socialActivityForm=ak;A._settingsInput=ao;var am=function(ar,at){if(ar.length>0){al.dataSet=ar;al.modelName=at;A._addSettingsDisplay(al)}};an.delegate("click",x.throttle(function(ar){var at=ar.currentTarget;if(at.test(aj)&&!ar.target.test("input")){A._revealSection(at,am)}else{if(at.test(v)){A._updateCheckboxStatus(ar)}}},250),[aj,v].join());var aq=ap.size()-1;x.some(ap,function(aw,at,ax){var av=aw.one(v).attr("checked");var au=aw;if(!av&&at==aq){av=true;au=ax.item(0)}var ar=au.attr(b);if(av){A._getSocialActivitySettingMapping(themeDisplay.getScopeGroupIdOrLiveGroupId(),ar,function(ay){am(ay,ar)});au.addClass(G)}return av})},_revealSection:function(am,al){var A=this;var ak=am.attr(b);am.radioClass(G);A._getSocialActivitySettingMapping(themeDisplay.getScopeGroupIdOrLiveGroupId(),ak,function(an){al(an,ak)})},_addSettingsDisplay:function(ak){var A=this;A.settingsDisplay=new q(ak).render(A._contentBox.empty())},_getItemByName:function(am,al,an){var A=this;var ak=al;if(!an){ak=A.NS+al}return am.one("[name="+ak+"]")},_getJsonSettings:function(ak){var A=this;return{actions:ak.getSettingsJSON(),modelName:A._originalConfig.modelName}},_getSocialActivitySettingMapping:function(al,ak,am){var A=this;Liferay.Service("/socialactivitysetting/get-json-activity-definitions",{groupId:al,className:ak},am)},_onSocialActivityFormSubmit:function(al){var A=this;var ak=al.currentTarget;al.halt();A._updateSocialActivitySettings(ak);submitForm(ak)},_updateCheckboxStatus:function(al){var A=this;var am=al.currentTarget;var ak=am.ancestor(aj).attr(b);Liferay.Service("/socialactivitysetting/update-activity-setting",{groupId:themeDisplay.getScopeGroupIdOrLiveGroupId(),className:ak,enabled:am.attr("checked")})},_updateSocialActivitySettings:function(ak){var A=this;A._settingsInput.val(x.JSON.stringify(A._getJsonSettings(A.settingsDisplay)))}}});var q=x.Component.create({ATTRS:{buttonsNode:{valueFn:function(){return H.create(L)}},id:{value:K},modelName:{value:K}},NAME:k,prototype:{initializer:function(ak){var A=this;A._settingsFields={}},renderUI:function(){var A=this;var ak=A.get(t);var aq=A._originalConfig;var ap=aq.activityDefinitionLanguageKeys;var ao=c.render({conjunctionText:Liferay.Language.get("or").toLowerCase(),containerText:Liferay.Language.get("social-activity-setting-container-label"),headerText:Liferay.Language.get("social-activity-setting-header-label"),saveText:ab});var am=ao.one(".container-drop-box");var al=ao.one(".settings-header");var an=al.one(".settings-actions");x.each(aq.dataSet,function(av,at,aw){av.localizedName=ap[av.modelName+"."+av.languageKey];av.settingsDisplay=A;av.counterSettings=aq.counterSettings;var ar=new u(av);ar.addTarget(A);var au=an;if(ar.get(m)){au=am}ar.render(au);A._settingsFields[ar.get(aa)]=ar});A.actionsNode=an;A.bodyNode=am;A.headerNode=al;A._handleConjunction();ak.append(ao)},bindUI:function(){var A=this;A.actionsNode.delegate("click",x.rbind("_toggleField",A,false),s,A);A.bodyNode.delegate("click",A._onBodyNodeClick,[o,j].join(),A);A.after("settings-field:collapsedChange",A._afterSettingsFieldCollapsed)},getSettingsJSON:function(){var A=this;var al=[];var ak=A._settingsFields;for(var am in ak){al.push(ak[am].getSettingsJSON())}return al},_afterSettingsFieldCollapsed:function(am){var A=this;var an=am.newVal;var al=am.target.get(D);var ak=A.actionsNode;if(!an){ak=A.bodyNode}else{A._toggleLimitFields(al,false)}ak.append(al)},_handleConjunction:function(){var A=this;var am=A.actionsNode;var ak=A._actionsConjunction;if(!ak){ak=am.one(M);A._actionsConjunction=ak}var al=am.all(s);var an=al.size();if(an>1){am.insert(ak,al.last());ak.show()}else{ak.hide();A.headerNode.toggle(an==1)}},_onBodyNodeClick:function(ak){var A=this;var al=ak.currentTarget;if(al.test(o)){A._toggleField(ak,true)}else{var am=!(al.hasClass(ad));A._toggleLimitFields(al.ancestor(s),am)}},_toggleField:function(ak,am){var A=this;var al=l.getByNode(ak.currentTarget);al.set("collapsed",am,C);al.set(m,!am);A._handleConjunction()},_toggleLimitFields:function(al,an){var A=this;al.one(I).toggle(an);var ak=al.one(j);var am=y;if(an){am=B}ak.toggleClass(ad,an);ak.attr("title",am)}}});var u=x.Component.create({ATTRS:{active:{value:false},activityType:{value:0},collapsed:{value:false},contributionIncrement:{value:0},contributionLimitEnabled:{value:true},contributionLimitPeriod:{value:1},contributionLimitValue:{value:0},languageKey:{value:K},localizedName:{value:K},participationIncrement:{value:0},participationLimitEnabled:{value:true},participationLimitPeriod:{value:1},participationLimitValue:{value:0},selected:{setter:x.DataType.Boolean.parse,value:false}},NAME:ac,UI_ATTRS:["collapsed","contributionIncrement"],prototype:{BOUNDING_TEMPLATE:V,initializer:function(am){var at=this;var aq=am.counters;at._counterSettings=am.counterSettings;at._settingsDisplay=am.settingsDisplay;var al=K;var ak=K;var ap=K;var an=K;var ar={};for(var ao=0;ao<aq.length;ao++){var A=aq[ao];al=p;ak=Z;ap=i;an=S;if(A.name=="participation"){al=f;ak=ah;ap=Y;an=J}else{if(A.name!="contribution"){continue}}ar[al]=A.increment;ar[ak]=A.limitEnabled;ar[ap]=A.limitPeriod;ar[an]=A.limitValue;if(A.enabled){ar[m]=true}}at.setAttrs(ar)},renderUI:function(){var A=this;var ak=A.get(t);A.get(D).attr(aa,A.get(aa));var am=A._counterSettings;var al=[];if(A.get(Z)){al.push({limitFirstText:Liferay.Language.get("social-activity-setting-contribution-limit-first-text"),limitPeriod:A.get(i),limitPeriods:F,limitSecondText:Liferay.Language.get("social-activity-setting-limit-second-text"),limitValue:A.get(S),limitValues:am.contributionLimitValues,type:"contribution"})}if(A.get(ah)){al.push({limitFirstText:Liferay.Language.get("social-activity-setting-participation-limit-first-text"),limitPeriod:A.get(Y),limitPeriods:F,limitSecondText:null,limitValue:A.get(J),limitValues:am.participationLimitValues,type:"participation"})}var an=N.render({buttons:[{text:Liferay.Language.get("limit"),title:y,type:"toggle"},{title:Liferay.Language.get("close"),type:"close"}],contributionIncrement:A.get(p),contributionIncrements:am.contributionIncrements,firstText:Liferay.Language.get("social-activity-setting-first-text"),fourthText:ai.sub(Liferay.Language.get("social-activity-setting-fourth-text"),[O]),labelText:A.get(Q),languageKey:A.get(aa),participationIncrement:A.get(f),participationIncrements:am.participationIncrements,rows:al,secondText:Liferay.Language.get("social-activity-setting-second-text"),thirdText:Liferay.Language.get("social-activity-setting-third-text")});an.all("select").on("change",A._selectOnChange,A);ak.append(an)},syncUI:function(){var A=this;A.set("collapsed",!A.get(m))},getSettingsJSON:function(){var A=this;return A.getAttrs([m,af,p,Z,i,S,aa,f,ah,Y,J])},_selectOnChange:function(am){var A=this;var ak=am.currentTarget.attr("id");var al=A.get(aa);ak=ak.replace(al+"_",K);A.set(ak,am.currentTarget.val(),C)},_setToDefaultValue:function(){var A=this;A.reset(p);A.reset(i);A.reset(S);A.reset(f);A.reset(Y);A.reset(J)},_uiSetCollapsed:function(al){var A=this;var ak=A.get(D);ak.toggleClass(T,!al);ak.toggleClass(W,al)},_uiSetContributionIncrement:function(al,am){var A=this;var an=A.get(t).one(".contribution-increment");if(an){an.html(al);if(am==a){var ak=an.ancestor();ak.setStyle("backgroundColor",w.FADE_COLOR_START);ak.transition({backgroundColor:w.FADE_COLOR_END,duration:1.5})}}}}});var w=Liferay.namespace("Portlet.SocialActivity");w.Admin=z;w.SettingsDisplay=q;w.SettingsField=u;w.FADE_COLOR_END="transparent";w.FADE_COLOR_START="#F7F082"},"",{requires:["aui-base","aui-datatype","aui-template-deprecated","liferay-portlet-base","transition"]});